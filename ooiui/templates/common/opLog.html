{% extends "common/base.html" %}

{% block title %}
<title>Operations Log</title>
{% endblock %}

{% block beforebootstrap %}

{% endblock %}

{% block head %}
<link rel="stylesheet" href="/css/compiled/basic.css" type="text/css" />
<link rel="stylesheet" href="/css/common/timeline.css" type="text/css" />
<!-- Partials -->
<script src="/js/partials/compiled/OpLog.js" type="text/javascript"></script>
<script src="/js/compiled/opLog.js" type="text/javascript"></script>

<style>
.panel-title a {
  display: block;
}
.panel-title a:hover {
  text-decoration: none;
}
.panel-title a:focus {
  text-decoration: none;
}
#accordion .panel-heading {
  color: #fff;
  background-image: linear-gradient(to bottom,#337ab7 0,#265a88 100%);
}
#opLogDiv {
  width	: 100%;
  height	: 300px;
}
.watch-when {
  font-size: 10px;
  color: #333;
}

/*trying different color combinations...
depending on over all color theme
>>---->also needs a clicked color and hover color<----<<
>>---->also needs better font and font-size<----<<
*/
.li-blue {
  background: #BBD9EE;
}

.li-green {
  background: #E7E4D3;
}
/*.li-blue {
  background: #C0C0C0;
}

.li-green {
  background: #E7E4D3;
}*/
.btnStartStop {
  float: right;
}
</style>
{% endblock %}

{%block body %}
<div id="wrapper">
  <div id="sidebar-wrapper" class="navbar-default">
  </div>

  <div id="page-content-wrapper">
    <div class="container-fluid">
      <div class="row">
        <div  class="col-lg-4">
          <div class="panel">
            <div class="panel-heading">
              <strong><span class="fa fa-navicon"></span> Watches</strong>
              <div class="pull-right dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                  <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a href="#">Watch stuff</a>
                  </li>
                </ul>
              </div>

            </div>

            <div id="panelWatch" class="panel-body"></div>

          </div>
        </div>


        <div class="col-lg-8">
          <div class="panel">
            <div id="new-event" class="panel-heading">
              <strong><span class="fa fa-tasks"></span> Events</strong>

            </div>

            <div id="panelEvents" class="panel-body"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">

/*
 * OOI is the main class that we extend from to create behavior and render pages.
 *
 * Here we create the application by extending OOI with Backbone.Events, this
 * gives us the ability to listen to events from models and/or views. When we
 * hear these events the main application can then trigger another view to
 * render, or in this case cause a collection to be fetched as a result.
 */

_.extend(OOI.prototype, Backbone.Events,  {
  login: new LoginModel(),
  // Models and collections
  collections: {
    // Instantiate a new Organizations collection
    organizations: new Organizations(),
    // watches is the Watch collection, by default is un-fetched
    watches: new Watches(),
    //events: new Events(),
    events: new EventsCollection()
  },
  start: function() {
    // Navbar
    // Instantiate the navbar view
    this.navbar = new NavbarView({login: this.login});
    // Bind the element to the top of the <body>
    $('body').prepend(this.navbar.el);

    // Sidebar
    // Instantiate a new OrgSidebarView and tell it to use our organizations as
    // the collection
    this.orgSidebarView = new OrgSidebarView({
      collection: this.collections.organizations
    });
    // Bind it to the element with the id of 'sidebar-wrapper'
    $('#sidebar-wrapper').html(this.orgSidebarView.el);

    // Event listener
    // This event listener allows us to capture a custom named event called
    // 'org:click' from the view. When we hear this event, we will execute an
    // instance method orgSelection
    //
    // The event will pass a model_id of the selected organization as a
    // parameter.
    this.listenTo(this.orgSidebarView, 'org:click', this.orgSelection);


    // Left Panel
    // We create a watch view that will be empty at first.
    this.watchView = new WatchView({
      collection: this.collections.watches
    });

    this.listenTo(this.watchView, 'watch:click', this.watchSelection);
    // We bind the watch view to the middle panel with the id 'panelWatch'
    $('#panelWatch').html(this.watchView.el);

    //Display the contents of the events in two views
    if ($('#timeline-view').hasClass("active")){
      
      this.timelineEventView = new TimeLineEventView({
        collection: this.collections.events
      });
      $('#panelEvents').html(this.timelineEventView.el);

    }else{

      this.eventView = new EventView({
        collection: this.collections.events
      });
      $('#panelEvents').html(this.eventView.el);
    }    

    this.newEventView = new NewEventView();
    $('#new-event').append(this.newEventView.el);    
  },
  /*
   * orgSelection is called by the event listener for org:click. The trigger
   * from the OrgSidebarView passes the organization_id in as a parameter. With
   * this we can cause the WatchView to re-render with the new watches we'll
   * fetch, using the organization_id as a query parameter.
   */
  orgSelection: function(organization_id) {
    // We have selected a new organization, so now we need to update the watch
    // GET /api/watch?organization_id=<organization_id>
    this.collections.watches.fetch({
      data: $.param({organization_id: organization_id}),
    });
    // Note: the watchview has an event listener that listens for sync events
    // from this collection, so when the feth completes, the event will trigger
    // and the watch view will re-render with the new watches.
  },
  watchSelection: function(watch_id) {
    this.collections.events.fetch({
      data: $.param({watch_id: watch_id}),
    });
  }
});
// Instantiate the application for this page
var ooi = new OOI();

$(document).ready(function() {
  // Once the DOM is loaded, we start our application
  ooi.start();
});


</script>

{% endblock %}
